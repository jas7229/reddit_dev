<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Avatar Arena | Unity Web Player</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <style>
      /* Devvit-specific styles */
      body {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
      }
      
      #unity-container {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      
      #unity-canvas {
        display: block;
        background: #000;
      }
      
      /* Mobile-specific styles */
      .unity-mobile #unity-container {
        width: 100vw;
        height: 100vh;
      }
      
      .unity-mobile #unity-canvas {
        width: 100vw;
        height: 100vh;
        max-width: 100vw;
        max-height: 100vh;
      }
      
      #unity-loading-bar {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        background: rgba(0, 0, 0, 0.8);
        padding: 30px;
        border-radius: 15px;
        border: 2px solid #FFD700;
        min-width: 300px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      #custom-loading-content {
        animation: pulse 2s infinite;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      #unity-logo {
        display: none !important;
      }
      
      #unity-progress-bar-empty {
        margin: 10px auto !important;
        width: 100% !important;
        max-width: 250px !important;
      }
      
      #loading-tips {
        width: 100% !important;
        text-align: center !important;
      }
      
      @keyframes pulse {
        0% { opacity: 0.8; }
        50% { opacity: 1; }
        100% { opacity: 0.8; }
      }
      
      #unity-warning {
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        z-index: 1001;
      }
      
      #unity-footer {
        display: none; /* Hide the entire footer */
      }
      
      #unity-fullscreen-button {
        position: fixed !important;
        top: 10px !important;
        left: 10px !important;
        transform: none !important;
        background: rgba(0, 0, 0, 0.7) !important;
        color: white !important;
        padding: 8px 12px !important;
        border-radius: 5px !important;
        font-size: 12px !important;
        cursor: pointer !important;
        z-index: 1500 !important;
        display: block !important;
      }
      
      #unity-fullscreen-button {
        cursor: pointer;
        background: rgba(255, 255, 255, 0.8);
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
      }
      
      #unity-fullscreen-button:hover {
        background: rgba(255, 255, 255, 1);
      }
      
      /* Hide any Unity logos that might appear */
      .unity-logo, 
      [class*="unity-logo"],
      [id*="unity-logo"] img {
        display: none !important;
      }
      
      /* Make sure our custom logo looks great */
      #custom-logo {
        z-index: 1000;
      }
      
      /* Traditional left-to-right progress bar */
      #unity-progress-bar-container {
        position: relative !important;
      }
      
      #unity-progress-bar-empty {
        display: none !important;
      }
      
      #unity-progress-bar-full {
        display: block !important;
        position: relative !important;
        transform-origin: left center !important;
      }
    </style>
  </head>
  <body>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
      <div id="unity-loading-bar">
        <div id="custom-loading-content">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="color: #FFD700; margin: 0; font-family: Arial, sans-serif;">‚öîÔ∏è Avatar Arena</h2>
            <p style="color: #FFF; margin: 5px 0; font-size: 14px;">Loading your epic adventure...</p>
          </div>
          
          <!-- User Avatar Display -->
          <div id="user-avatar-container" style="position: absolute; bottom: 10px; left: 10px; display: none;">
            <img id="user-avatar-img" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid #FFD700;" />
            <div id="user-name" style="color: #FFD700; font-size: 12px; text-align: center; margin-top: 5px;"></div>
          </div>
          <!-- Custom logo container (separate from Unity's logo) -->
          <div id="custom-logo" style="margin: 10px auto; text-align: center;">
            <img src="ArenaIcon.png" alt="Avatar Arena" style="width: 80px; height: 80px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
          </div>
          <div id="unity-logo" style="display: none;"></div>
          <div id="unity-progress-bar-container" style="width: 280px; margin: 15px auto; background: rgba(0,0,0,0.3); border-radius: 12px; height: 20px; overflow: hidden; border: 1px solid rgba(255,215,0,0.5);">
            <div id="unity-progress-bar-empty" style="display: none;"></div>
            <div id="unity-progress-bar-full" style="background: linear-gradient(90deg, #FFD700, #FFA500); height: 100%; width: 0%; transition: width 0.3s ease; box-shadow: 0 0 8px rgba(255,215,0,0.6); border-radius: 0;"></div>
          </div>
          <div id="loading-tips" style="text-align: center; color: #CCC; font-size: 12px; margin-top: 10px;">
            <p id="loading-tip-text">Tip: Use special attacks to deal extra damage!</p>
          </div>
        </div>
      </div>
      <div id="unity-warning"></div>
      <div id="unity-footer">
        <div id="unity-fullscreen-button">‚õ∂ Fullscreen</div>
        <div id="unity-build-title" style="color: #FFD700; font-weight: bold;">‚öîÔ∏è Avatar Arena</div>
      </div>
    </div>

    <!-- Test Panel for API Testing (ADMIN ONLY) -->
    <div id="test-panel" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-width: 300px; z-index: 2000; display: none; visibility: hidden;">
      <div style="font-weight: bold; margin-bottom: 10px;">üß™ Admin Panel</div>
      
      <!-- Tab Navigation -->
      <div style="margin-bottom: 10px; border-bottom: 1px solid #666;">
        <button id="tab-testing" style="padding: 3px 8px; font-size: 10px; background: #4CAF50; color: white; border: none; cursor: pointer; margin-right: 3px;">
          Testing
        </button>
        <button id="tab-admin" style="padding: 3px 8px; font-size: 10px; background: #666; color: white; border: none; cursor: pointer;">
          Admin Tools
        </button>
      </div>
      
      <!-- Testing Page -->
      <div id="page-testing" style="display: block;">
        <button id="test-get-player" style="margin: 2px; padding: 5px; font-size: 11px;">Get Player</button>
        <button id="test-leaderboard" style="margin: 2px; padding: 5px; font-size: 11px;">Get Leaderboard</button>
        <br>
        <div style="margin: 5px 0; font-size: 10px;">üèÜ Test Leaderboard:</div>
        <button id="test-create-entries" style="margin: 1px; padding: 3px; font-size: 10px; background: #4CAF50; color: white;">Add Test Bots</button>
        <button id="test-remove-entries" style="margin: 1px; padding: 3px; font-size: 10px; background: #ff9800; color: white;">Remove Test Bots</button>
        <button id="test-debug-leaderboard" style="margin: 1px; padding: 3px; font-size: 10px; background: #2196F3; color: white;">Debug Leaderboard</button>
      </div>
      
      <!-- Admin Tools Page -->
      <div id="page-admin" style="display: none;">
        <div style="font-weight: bold; color: #ff6b6b; margin-bottom: 10px;">üîß ADMIN TOOLS</div>
        
        <div style="margin-bottom: 10px;">
          <button id="admin-reset-specific-users" style="padding: 3px 8px; font-size: 11px; background: #ff6b6b; color: white; border: none; cursor: pointer; margin-bottom: 5px; width: 100%;">
            Reset Problem Users
          </button>
          <button id="admin-reset-confirm" style="padding: 3px 8px; font-size: 11px; background: #ff3333; color: white; border: none; cursor: pointer; width: 100%; display: none; margin-bottom: 3px;">
            CONFIRM RESET
          </button>
          <button id="admin-reset-cancel" style="padding: 3px 8px; font-size: 11px; background: #666; color: white; border: none; cursor: pointer; width: 100%; display: none;">
            Cancel
          </button>
          <small style="color: #ccc; font-size: 9px; display: block;">Reset exploiter to level 1</small>
        </div>
        
        <div style="margin-bottom: 10px;">
          <button id="admin-list-players" style="padding: 3px 8px; font-size: 11px; background: #4ecdc4; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 3px;">
            List All Players
          </button>
          <button id="admin-refresh-leaderboard" style="padding: 3px 8px; font-size: 11px; background: #2196F3; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 3px;">
            Refresh Leaderboard
          </button>
          <button id="admin-rebuild-leaderboard" style="padding: 3px 8px; font-size: 11px; background: #9C27B0; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 3px;">
            Rebuild Leaderboard
          </button>
          <button id="admin-dedupe-leaderboard" style="padding: 3px 8px; font-size: 11px; background: #FF5722; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 3px;">
            Remove Duplicates
          </button>
          <button id="admin-delete-user" style="padding: 3px 8px; font-size: 11px; background: #E91E63; color: white; border: none; cursor: pointer; width: 100%;">
            Delete LIFT_TICKET_BOT
          </button>
        </div>
        
        <div style="margin-bottom: 10px;">
          <button id="test-nuclear-cleanup" style="padding: 3px 8px; font-size: 11px; background: #f44336; color: white; border: none; cursor: pointer; width: 100%;">
            ‚ò¢Ô∏è NUKE LEADERBOARD
          </button>
        </div>
      </div>
      
      <!-- Common Controls -->
      <div style="border-top: 1px solid #666; margin-top: 10px; padding-top: 10px;">
        <button id="test-toggle-panel" style="margin: 2px; padding: 5px; font-size: 11px;">Hide Panel</button>
      </div>
      
      <div id="test-results" style="margin-top: 10px; max-height: 200px; overflow-y: auto; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 3px;">
        <div>Click buttons to test API...</div>
      </div>
    </div>
    
    <!-- Small reopen button (ADMIN ONLY) -->
    <div id="test-reopen-btn" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px; border-radius: 50%; font-family: monospace; font-size: 14px; cursor: pointer; z-index: 2001; display: none; visibility: hidden; width: 30px; height: 30px; text-align: center; line-height: 14px;">
      üß™
    </div>
    
    <!-- Admin Access Button (ADMIN ONLY) -->
    <div id="admin-access-btn" style="position: fixed; top: 50px; right: 10px; background: rgba(0, 0, 0, 0.6); color: #ccc; padding: 6px 10px; border-radius: 3px; font-family: monospace; font-size: 11px; cursor: pointer; z-index: 2001; display: none; visibility: hidden; border: 1px solid rgba(255,255,255,0.2); opacity: 0.7;">
      ‚öôÔ∏è
    </div>
    
    <!-- Load scripts in proper order -->
    <script src="unity-api.js"></script>
    <script src="unity-setup.js"></script>
    <script src="unity-loader.js"></script>
    <script src="test-panel.js"></script> <!-- Test panel is disabled for public version -->
    
    <!-- Custom Loading Screen Script -->
    <script>
      // Loading tips that rotate while Unity loads
      const loadingTips = [
        "Tip: Use special attacks to deal extra damage!",
        "Tip: Defend to reduce incoming damage by 50%",
        "Tip: Heal when your HP gets low",
        "Tip: Level up to increase your stats",
        "Tip: Earn gold by winning battles",
        "Tip: Each enemy has different strengths",
        "Tip: Your Reddit avatar appears in battle!"
      ];
      
      let currentTipIndex = 0;
      let tipInterval;
      
      function rotateTips() {
        const tipElement = document.getElementById('loading-tip-text');
        if (tipElement) {
          tipElement.style.opacity = '0';
          setTimeout(() => {
            currentTipIndex = (currentTipIndex + 1) % loadingTips.length;
            tipElement.textContent = loadingTips[currentTipIndex];
            tipElement.style.opacity = '1';
          }, 300);
        }
      }
      
      // Load user avatar during loading
      async function loadUserAvatar() {
        try {
          const avatarContainer = document.getElementById('user-avatar-container');
          const avatarImg = document.getElementById('user-avatar-img');
          const userName = document.getElementById('user-name');
          
          if (!avatarContainer || !avatarImg || !userName) return;
          
          // Get user data
          const response = await fetch('/api/user-data');
          const data = await response.json();
          
          if (data.status === 'success' && data.avatarUrl && data.username) {
            avatarImg.src = data.avatarUrl;
            userName.textContent = data.username;
            avatarContainer.style.display = 'block';
            
            console.log('[Loading] User avatar loaded:', data.username);
          }
        } catch (error) {
          console.log('[Loading] Could not load user avatar:', error);
        }
      }
      
      // Start rotating tips when page loads
      window.addEventListener('DOMContentLoaded', () => {
        const tipElement = document.getElementById('loading-tip-text');
        if (tipElement) {
          tipElement.style.transition = 'opacity 0.3s ease';
          tipInterval = setInterval(rotateTips, 3000); // Change tip every 3 seconds
        }
        
        // Load user avatar
        loadUserAvatar();
      });
      
      // Stop rotating tips when Unity loads
      window.addEventListener('load', () => {
        setTimeout(() => {
          if (tipInterval) {
            clearInterval(tipInterval);
          }
        }, 2000);
      });
    </script>

  </body>
</html>
